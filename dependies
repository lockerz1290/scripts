#!/usr/bin/env bash
set -euo pipefail

INPUT_FILE="npm-depends.txt"
OUTPUT_DIR="npm-tarballs"
FAILED_FILE="failed-downloads.txt"

mkdir -p "$OUTPUT_DIR"
> "$FAILED_FILE"

echo "ðŸ“¦ Pobieranie paczek z $INPUT_FILE ..."

while IFS= read -r url || [ -n "$url" ]; do
  # pomijamy puste linie
  [ -z "$url" ] && continue

  filename="$(basename "$url")"
  echo "â¬‡ï¸  Pobieram $filename z $url"

  if ! wget -q -O "$OUTPUT_DIR/$filename" "$url"; then
    echo "âš ï¸  Nie udaÅ‚o siÄ™ pobraÄ‡ $url"
    echo "$url" >> "$FAILED_FILE"
  fi
done < "$INPUT_FILE"

echo "âœ… Pobieranie zakoÅ„czone."
if [ -s "$FAILED_FILE" ]; then
  echo "âš ï¸ NiektÃ³re pobrania siÄ™ nie powiodÅ‚y. SprawdÅº plik: $FAILED_FILE"
else
  echo "Wszystkie paczki pobrane poprawnie."
fi
